<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f5f7fb; padding: 20px; }
        .card { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h1 { color: #008069; font-size: 22px; margin-top: 0; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø·ÙˆØ§Øª */
        .step { position: relative; padding-right: 30px; margin-bottom: 20px; }
        .step::before { 
            content: ''; position: absolute; right: 0; top: 5px; 
            width: 12px; height: 12px; background: #008069; border-radius: 50%; 
        }
        .step::after {
            content: ''; position: absolute; right: 5px; top: 20px;
            width: 2px; height: 100%; background: #eee;
        }
        .step:last-child::after { display: none; }
        .step-title { font-weight: bold; font-size: 16px; }
        .step-desc { font-size: 13px; color: #666; margin-top: 5px; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¨ÙˆÙƒØ³Ø§Øª */
        .box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-top: 20px; }
        .btn-action { 
            width: 100%; background: #008069; color: white; border: none; 
            padding: 12px; border-radius: 8px; font-family: inherit; font-weight: bold; 
            cursor: pointer; margin-top: 10px;
        }
        .vaccine-item {
            display: flex; justify-content: space-between; padding: 10px; 
            border-bottom: 1px solid #eee; font-size: 14px;
        }

        /* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Ø§Ù„Ø¬Ø¯ÙŠØ¯) --- */
        .modal {
            display: none; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); align-items: center; justify-content: center;
            z-index: 999;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 15px; 
            text-align: center; width: 320px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .data-row {
            display: flex; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid #eee; font-size: 14px;
        }
        .data-label { color: #666; }
        .data-value { font-weight: bold; color: #333; }
        .confirm-btn {
            background: #008069; color: white; width: 100%; padding: 12px;
            border: none; border-radius: 8px; margin-top: 15px; cursor: pointer; font-weight: bold;
        }
        .cancel-btn {
            background: transparent; color: #666; border: none; margin-top: 10px; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="card">
    <a href="journeys.html" style="text-decoration:none; color:#999; float:left">Ø±Ø¬ÙˆØ¹</a>
    <h1>Ø±Ø­Ù„Ø© Ù‚Ø¯ÙˆÙ… Ù…ÙˆÙ„ÙˆØ¯ ğŸ¼</h1>
    
    <div style="margin-bottom: 20px; text-align: center;">
        <p style="font-size: 14px; color: #666;">ÙˆØµÙ„ ØªØ¨Ù„ÙŠØº ÙˆÙ„Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡:</p>
        <button onclick="openVerifyModal()" style="background: #eab308; color: #fff; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">
            âš ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯
        </button>
    </div>

    <div id="steps-container" style="margin-top:20px;">
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ§Øª...</p>
    </div>

    <div class="box">
        <h3 style="margin:0 0 10px 0;">ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</h3>
        <p style="font-size:13px; color:#666">Ø§Ø¶ØºØ· Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (01-09-2025)</p>
        <button class="btn-action" onclick="showVaccines()">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</button>
        <div id="vaccine-list" style="margin-top:15px; display:none; background:white; border-radius:8px; border:1px solid #eee;"></div>
    </div>

    <div class="box" style="background:#fff7ed; border-color:#fed7aa">
        <h3 style="margin:0 0 10px 0; color:#c2410c">ğŸ“ Ø£Ù‚Ø±Ø¨ Ù…Ø±ÙƒØ² ØµØ­ÙŠ</h3>
        <button class="btn-action" style="background:#ea580c" onclick="showCenter()">Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø­ÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
        <div id="center-info" style="margin-top:10px; font-weight:bold; color:#c2410c"></div>
    </div>
</div>

<div id="verifyModal" class="modal">
    <div class="modal-content">
        <h3 style="color:#008069; margin-top:0">Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¨Ù„ÙŠØº Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© ğŸ“</h3>
        <p style="font-size:13px; color:#666; margin-bottom:15px">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰:</p>
        
        <div class="data-row">
            <span class="data-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰:</span>
            <span class="data-value" id="modal-hospital">...</span>
        </div>
        <div class="data-row">
            <span class="data-label">Ø±Ù‚Ù… Ø§Ù„ØªØ¨Ù„ÙŠØº:</span>
            <span class="data-value" id="modal-ref">...</span>
        </div>
        <div class="data-row">
            <span class="data-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©:</span>
            <span class="data-value" id="modal-date">...</span>
        </div>
        <div class="data-row">
            <span class="data-label">Ø§Ù„Ø¬Ù†Ø³:</span>
            <span class="data-value" id="modal-gender">...</span>
        </div>
        <div class="data-row">
            <span class="data-label">Ø§Ø³Ù… Ø§Ù„Ø£Ù…:</span>
            <span class="data-value">Ù†ÙˆØ±Ø© Ø³Ø¹Ø¯ (1020304050)</span>
        </div>

        <button class="confirm-btn" onclick="confirmData()">âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©ØŒ Ø§Ø¹ØªÙ…Ø§Ø¯</button>
        <button class="cancel-btn" onclick="closeModal()">Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø®Ø·Ø£</button>
    </div>
</div>

<script>
    // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    let birthData = {};

    // 1. Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ù†Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø®Ø·ÙˆØ§Øª
    window.onload = async function() {
        try {
            // Ø¬Ù„Ø¨ Ø§Ù„Ø®Ø·ÙˆØ§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API ÙˆØ§Ø­Ø¯ (Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ ÙØµÙ„Ù‡Ù…ØŒ Ù‡Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯)
            const res = await fetch("http://127.0.0.1:5000/api/baby_journey");
            const data = await res.json();
            
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†Ø­ØªØ§Ø¬ Ù†Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù†Øµ Ø§Ù„ÙˆØµÙ Ù„Ø£Ù†Ù†Ø§ Ù…Ø§ Ø³ÙˆÙŠÙ†Ø§ Ù„Ù‡Ø§ API Ø®Ø§ØµØŒ 
            // Ù„ÙƒÙ† Ù„Ù„Ø£ÙØ¶Ù„ÙŠØ© Ø³Ù†Ø£Ø®Ø°Ù‡Ø§ Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„ÙŠ ÙƒØªØ¨Ù†Ø§Ù‡Ø§ ÙÙŠ Ø¨Ø§ÙŠØ«ÙˆÙ†
            // (Ø³Ø£ÙØªØ±Ø¶ Ù‡Ù†Ø§ Ù‚ÙŠÙ… Ø«Ø§Ø¨ØªØ© Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø©ØŒ Ø£Ùˆ Ù†Ø¹Ø¯Ù„ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù„ÙŠØ±Ø³Ù„Ù‡Ø§ Ù…Ù†ÙØµÙ„Ø©)
            // Ù„Ù„ØªØ¨Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ù‡Ø§ÙƒØ«ÙˆÙ†ØŒ Ø³Ø£Ø¶Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª Ø£Ùˆ Ø£Ø³ØªØ®Ø±Ø¬Ù‡Ø§
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ù„Ø£Ù† Ø§Ù„Ù€ API Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ±Ø¬Ø¹ Ù†ØµÙˆØµ ÙˆØµÙÙŠØ©)
            birthData = {
                hospital: "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ©",
                ref: "REF-2025-99",
                date: "2025-09-01",
                gender: "Ø°ÙƒØ±"
            };

            const html = data.steps.map(s => `
                <div class="step">
                    <div class="step-title">${s.title}</div>
                    <div class="step-desc">${s.desc}</div>
                </div>
            `).join('');
            document.getElementById("steps-container").innerHTML = html;

        } catch(e) {
            console.error(e);
            alert("ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ app.py");
        }
    }

    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function openVerifyModal() {
        document.getElementById("modal-hospital").innerText = birthData.hospital;
        document.getElementById("modal-ref").innerText = birthData.ref;
        document.getElementById("modal-date").innerText = birthData.date;
        document.getElementById("modal-gender").innerText = birthData.gender;
        
        document.getElementById("verifyModal").style.display = "flex";
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯
    function confirmData() {
        alert("ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³Ù…ÙŠØ©.");
        document.getElementById("verifyModal").style.display = "none";
        // Ù‡Ù†Ø§ Ù…Ù…ÙƒÙ† Ù†ØºÙŠØ± Ù„ÙˆÙ† Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ø£Ø®Ø¶Ø± Ø¹Ø´Ø§Ù† ÙŠØ¨ÙŠÙ† Ø§Ù†Ù‡ ØªÙ…
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    function closeModal() {
        document.getElementById("verifyModal").style.display = "none";
    }

    // 2. Ø²Ø± Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª
    async function showVaccines() {
        const listDiv = document.getElementById("vaccine-list");
        listDiv.style.display = "block";
        listDiv.innerHTML = "<p style='padding:10px'>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</p>";

        const res = await fetch("http://127.0.0.1:5000/api/baby_vaccines");
        const data = await res.json();

        const html = data.vaccines.map(v => `
            <div class="vaccine-item">
                <span>ğŸ’‰ ${v.name}</span>
                <span style="color:#008069; font-weight:bold">${v.due_date}</span>
            </div>
        `).join('');
        listDiv.innerHTML = html;
    }

    // 3. Ø²Ø± Ø§Ù„Ù…Ø±ÙƒØ²
    async function showCenter() {
        const res = await fetch("http://127.0.0.1:5000/api/nearest_center");
        const data = await res.json();
        document.getElementById("center-info").innerText = `âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯: ${data.center.name}`;
    }
</script>

</body>
</html>
